package main

import (
	"fmt"
	"sync"
	"time"
)

var (
	wg       sync.WaitGroup
	rangeNum chan int = make(chan int)
)

func init() {
	fmt.Println("init")
	go func() {
		numList := &[]int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
		for _, num := range *numList {
			// 将数据写入rangeNum中
			rangeNum <- num
		}
		close(rangeNum)
	}()
}

func main() {
	// 从rangeNum中读取数据
	// 启动多个协程
	for num := range rangeNum {
		wg.Add(1)
		go func(num int) {
			defer wg.Done()
			// 单个进程
			oneProcess(num)
		}(num)
	}

	// 另外启动一个协程
	wg.Add(1)
	go func() {
		defer wg.Done()
		// 实现了Message接口
		userMsg()
	}()
	wg.Wait()
}

type Message interface {
	Send()
}

type user struct {
	name  string
	score int
}

func (u *user) Send() {
	fmt.Println("hi", u.name, "this is your ", u.score)
}

func sendMessage(msg Message) {
	msg.Send()
}

// userMsg 实现了Message接口
func userMsg() {
	var u Message = &user{name: fmt.Sprintf("user-%d", 1), score: 100}
	sendMessage(u)
}

// 单个进程
func oneProcess(num int) {
	time.Sleep(time.Microsecond * 100 * time.Duration(num))
	fmt.Printf("sleep %d microseconds\n", num*100)
}
